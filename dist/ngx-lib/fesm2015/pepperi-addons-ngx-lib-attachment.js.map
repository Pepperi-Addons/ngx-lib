{"version":3,"file":"pepperi-addons-ngx-lib-attachment.js","sources":["../../../projects/ngx-lib/attachment/attachment.component.html","../../../projects/ngx-lib/attachment/attachment.component.ts","../../../projects/ngx-lib/attachment/attachment.module.ts","../../../projects/ngx-lib/attachment/public-api.ts","../../../projects/ngx-lib/attachment/pepperi-addons-ngx-lib-attachment.ts"],"sourcesContent":["<!-- New code -->\r\n<ng-template #pepperiTemplate>\r\n    <files-uploader [key]=\"key\" [src]=\"src\" [label]=\"label\" [required]=\"required\" [disabled]=\"disabled\"\r\n        [xAlignment]=\"xAlignment\" [rowSpan]=\"rowSpan\" [controlType]=\"controlType\" [form]=\"form\"\r\n        [layoutType]=\"layoutType\" [standAlone]=\"standAlone\" (fileChanged)=\"onFileChanged($event)\"\r\n        (elementClicked)=\"onFileClicked($event)\" [acceptedExtensions]=\"acceptAttachmentType\">\r\n    </files-uploader>\r\n</ng-template>\r\n\r\n<ng-template #pepperiReadonlyTemplate>\r\n    <ng-container *ngIf=\"src?.length > 0; then notEmptyBlock; else emptyBlock\"></ng-container>\r\n    <ng-template #notEmptyBlock>\r\n        <div class=\"pepperi-file-container\">\r\n            <a [id]=\"key\" class=\"color-link body-sm pepperi-card-input \" *ngIf=\"src != null\" title=\"{{ src }}\"\r\n                target=\"_blank\" href=\"{{ src }}\">{{ src }}</a>\r\n        </div>\r\n    </ng-template>\r\n    <ng-template #emptyBlock>\r\n        <span>&nbsp;</span>\r\n    </ng-template>\r\n</ng-template>\r\n\r\n<ng-container *ngIf=\"layoutType === LAYOUT_TYPE.PepperiForm\">\r\n    <div class=\"pepperi-file-container\" [ngClass]=\"{ 'one-row': rowSpan == 1, 'stand-alone': standAlone }\">\r\n        <pep-field-title [label]=\"label\" [required]=\"required\" [disabled]=\"disabled\" [xAlignment]=\"xAlignment\"\r\n            [showTitle]=\"showTitle\">\r\n        </pep-field-title>\r\n        <ng-container *ngTemplateOutlet=\"pepperiTemplate\"></ng-container>\r\n    </div>\r\n</ng-container>\r\n\r\n<ng-container *ngIf=\"layoutType === LAYOUT_TYPE.PepperiCard\">\r\n    <ng-container *ngIf=\"false && isActive && !disabled; then selectedBlock; else notSelectedBlock\"></ng-container>\r\n    <ng-template #selectedBlock>\r\n        <div class=\"pepperi-file-container\" [ngClass]=\"{ 'one-row': rowSpan == 1, 'stand-alone': standAlone}\">\r\n            <ng-container *ngTemplateOutlet=\"pepperiTemplate\"></ng-container>\r\n        </div>\r\n    </ng-template>\r\n    <ng-template #notSelectedBlock>\r\n        <ng-container *ngTemplateOutlet=\"pepperiReadonlyTemplate\"></ng-container>\r\n    </ng-template>\r\n</ng-container>\r\n\r\n\r\n<ng-container *ngIf=\"layoutType === LAYOUT_TYPE.PepperiTable\">\r\n    <ng-container *ngIf=\"false && isActive && !disabled; then selectedBlock; else notSelectedBlock\"></ng-container>\r\n    <ng-template #selectedBlock>\r\n        <div class=\"pepperi-file-container one-row\">\r\n            <ng-container *ngTemplateOutlet=\"pepperiTemplate\"></ng-container>\r\n        </div>\r\n    </ng-template>\r\n    <ng-template #notSelectedBlock>\r\n        <ng-container *ngTemplateOutlet=\"pepperiReadonlyTemplate\"></ng-container>\r\n    </ng-template>\r\n</ng-container>\r\n","import { Component, OnInit, OnChanges, Input, Output, EventEmitter, ChangeDetectionStrategy, ElementRef, Renderer2, OnDestroy } from '@angular/core';\r\nimport { FormGroup } from '@angular/forms';\r\nimport { FileService, CustomizationService, LAYOUT_TYPE } from '@pepperi-addons/ngx-lib';\r\n\r\n@Component({\r\n    selector: 'pep-attachment',\r\n    templateUrl: './attachment.component.html',\r\n    styleUrls: ['./attachment.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class PepperiAttachmentComponent implements OnInit, OnChanges, OnDestroy {\r\n    @Input() key = '';\r\n    @Input() src = '';\r\n    @Input() label = '';\r\n    @Input() required = false;\r\n    @Input() disabled = false;\r\n    @Input() readonly = false;\r\n    @Input() xAlignment = '0';\r\n    @Input() rowSpan = 1;\r\n\r\n    controlType = 'attachment';\r\n\r\n    @Input() form: FormGroup = null;\r\n    @Input() showTitle = true;\r\n    @Input() layoutType: LAYOUT_TYPE = LAYOUT_TYPE.PepperiForm;\r\n    @Input() isActive = false;\r\n\r\n    @Output() valueChanged: EventEmitter<any> = new EventEmitter<any>();\r\n    @Output() elementClicked: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n    LAYOUT_TYPE = LAYOUT_TYPE;\r\n    fieldHeight = '';\r\n    standAlone = false;\r\n    dataURI = null;\r\n\r\n    acceptAttachmentType =\r\n        'application/pdf,application/json,text/csv,text/csv-schema,application/msword,application/vnd.ms-excel,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,image/bmp,image/jpg, image/jpeg, image/png, image/tif, image/tiff, txt, json';\r\n\r\n    constructor(\r\n        private customizationService: CustomizationService,\r\n        private renderer: Renderer2,\r\n        public element: ElementRef,\r\n        private fileService: FileService) { }\r\n\r\n    ngOnDestroy(): void {\r\n        if (this.elementClicked) {\r\n            this.elementClicked.unsubscribe();\r\n        }\r\n\r\n        if (this.valueChanged) {\r\n            this.valueChanged.unsubscribe();\r\n        }\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        if (this.form === null) {\r\n            this.standAlone = true;\r\n            this.form = this.customizationService.getDefaultFromGroup(this.key, this.src, this.required, this.readonly, this.disabled);\r\n\r\n            this.renderer.addClass(this.element.nativeElement, CustomizationService.STAND_ALONE_FIELD_CLASS_NAME);\r\n        }\r\n\r\n        this.fieldHeight = this.customizationService.calculateFieldHeight(this.layoutType, this.rowSpan, this.standAlone);\r\n    }\r\n\r\n    ngOnChanges(changes: any): void {\r\n        if (changes.src && changes.src.currentValue.length > 0) {\r\n            // Empty dataURI if there is change in the src.\r\n            this.dataURI = null;\r\n        }\r\n    }\r\n\r\n    onFileChanged(value: any): void {\r\n        this.dataURI = value.length > 0 ? JSON.parse(value) : null;\r\n        this.src = this.dataURI ? this.dataURI.fileStr : '';\r\n        this.customizationService.updateFormFieldValue(this.form, this.key, this.dataURI ? this.dataURI.fileExt : '');\r\n        this.valueChanged.emit({ apiName: this.key, value, controlType: this.controlType });\r\n    }\r\n\r\n    onFileClicked(event): void {\r\n        if (this.dataURI != null) {\r\n            const fileStrArr = this.dataURI.fileStr.split(';');\r\n            if (fileStrArr.length === 2) {\r\n                const win = window.open('', '_blank');\r\n                const contentType = fileStrArr[0].split(':')[1];\r\n                const base64 = fileStrArr[1].split(',')[1];\r\n                const blob = this.fileService.convertFromb64toBlob(base64, contentType);\r\n                const url = URL.createObjectURL(blob);\r\n                win.location.href = url;\r\n            }\r\n        } else {\r\n            if (this.fileService.isValidUrl(this.src)) {\r\n                const win = window.open('', '_blank');\r\n                win.location.href = this.src;\r\n            }\r\n        }\r\n\r\n        this.elementClicked.emit({ apiName: this.key, eventWhich: event.which });\r\n    }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ReactiveFormsModule, FormsModule } from '@angular/forms';\r\n\r\nimport { MatCommonModule } from '@angular/material/core';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\n\r\nimport { PepperiModule } from '@pepperi-addons/ngx-lib';\r\nimport { PepperiFieldTitleModule } from '@pepperi-addons/ngx-lib/field-title';\r\nimport { PepperiFilesUploaderModule } from '@pepperi-addons/ngx-lib/files-uploader';\r\n\r\nimport { PepperiAttachmentComponent } from './attachment.component';\r\n\r\n@NgModule({\r\n    imports: [\r\n        CommonModule,\r\n        ReactiveFormsModule,\r\n        FormsModule,\r\n        // Material modules\r\n        MatCommonModule,\r\n        MatFormFieldModule,\r\n        // Pepperi modules\r\n        PepperiModule,\r\n        PepperiFieldTitleModule,\r\n        PepperiFilesUploaderModule\r\n    ],\r\n    exports: [ PepperiAttachmentComponent ],\r\n    declarations: [ PepperiAttachmentComponent ],\r\n})\r\nexport class PepperiAttachmentModule {}\r\n","/*\r\n * Public API Surface of ngx-lib/attachment\r\n */\r\nexport * from './attachment.module';\r\nexport * from './attachment.component';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i0.ɵɵelementStart","i0.ɵɵlistener","i0.ɵɵelementEnd","i0.ɵɵproperty","i0.ɵɵelementContainer","i0.ɵɵtext","i0.ɵɵpropertyInterpolate","i0.ɵɵadvance","i0.ɵɵtextInterpolate","i0.ɵɵtemplate","i0.ɵɵelementContainerStart","i0.ɵɵelement","i0.ɵɵelementContainerEnd"],"mappings":"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"}